<!DOCTYPE html>
<html lang="ja" xmlns="http://www.w3.org/1999/xhtml" prefix="og: http://ogp.me/ns#">
  <head>
    
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="format-detection" content="telephone=no">
<link rel="alternate" type="application/rss+xml" title="RSS Feed" href="http://k3kaimu.github.io/atom.xml">
<link rel="shortcut icon" href="/favicon.ico">

    <title> Dの会 #4 資料 | Go to the future</title>
    
<meta property="og:type" content="blog">
<meta property="og:title" content="Dの会 #4 資料">
<meta property="og:description" content="


## Range, 文字列, 連想配列

-----------------------------

### 順番

* type, qualifier
* array, GC and foreach-loop
* **string, UTF**
* **Associative Arr...">
<meta property="og:url" content="http://k3kaimu.github.io/d%E3%81%AE%E4%BC%9A/2014/11/20/d-nokai4/">

<meta property="og:site_name" content="Go to the future">
<meta property="og:locale" content="ja_JP">
<meta name="twitter:card" content="summary">

<meta name="twitter:site" content="@k3_kaimu">


    
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/bootswatch/3.0.2/cerulean/bootstrap.min.css">
<link rel="stylesheet" href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.min.css">
<link rel="stylesheet" href="/assets/css/all.min.css">
<link rel="stylesheet" href="/assets/css/navigation.css">

    
<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
  <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
<![endif]-->

  </head>
  <body>
    
<div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <a href="/" class="navbar-brand">Go to the future</a>
      <button class="navbar-toggle" type="button" data-toggle="collapse" data-target="#navbar-main">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
    </div>
    <div class="navbar-collapse collapse" id="navbar-main">
      <ul class="nav navbar-nav js_nav">
        <li><a href="/blog/">Blog</a></li>
        <li><a href="/dmanual/">DManual</a></li>
        <li><a href="/dtips/">DTips</a></li>
        <!--<li><a href="/archives/">Index...</a></li>
        -->
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown">Index...<b class="caret"></b></a>
          <ul class="dropdown-menu">
            <li>
              <a href="/archives/" itemprop="sameAs" content="/archives/">
                <i class="fa fa-archive fa-lg"></i> Archives
              </a>
            </li>
            <li>
              <a href="/categories/" itemprop="sameAs" content="/categories/">
                <i class="fa fa-folder-open fa-lg"></i> Categories
              </a>
            </li>
            <li>
              <a href="/tags/" itemprop="sameAs" content="/tags/">
                <i class="fa fa-tags fa-lg"></i> Tags
              </a>
            </li>
          </ul>
        </li>
      </ul>
      <div id="owner" itemprop="author copyrightHolder editor" itemscope itemtype="http://schema.org/Person">
        <ul class="nav navbar-nav navbar-right">
          <li class="dropdown">
            <a href="#" class="dropdown-toggle" data-toggle="dropdown">k3-kaimu <b class="caret"></b></a>
            <ul class="dropdown-menu">
              
              <li>
                
                <a href="https://www.github.com/k3kaimu" itemprop="sameAs" content="https://www.github.com/k3kaimu">
                  <i class="fa fa-github-square fa-lg"></i> GitHub
                </a>
              </li>
              
              
              <li>
                
                <a href="http://www.twitter.com/k3_kaimu" itemprop="sameAs" content="http://www.twitter.com/k3_kaimu">
                  <i class="fa fa-twitter-square fa-lg"></i> Twitter
                </a>
              </li>
              
              
              
              <li>
                <a href="/atom.xml">
                  <i class="fa fa-rss-square fa-lg fa-lg"></i> Rss
                </a>
              </li>
            </ul>
          </li>
        </ul>
      </div>
    </div>
  </div>
</div>

    <div id="content">
      <div class="container">
        <article itemscope itemtype="http://schema.org/Article" itemref="owner">
          
<div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="page-header">
      <h1 itemprop="url" content="http://k3kaimu.github.io/d%E3%81%AE%E4%BC%9A/2014/11/20/d-nokai4/">
        <i class="fa fa-puzzle-piece fa-lg"></i> <span itemprop="name">Dの会 #4 資料</span>
      </h1>
    </div>
  </div>
</div>

          <div class="row">
            <div class="col-md-12 col-sm-12 col-xs-12">
              <div itmprop="articleBody">
                <!--
pandoc -s -t revealjs -V theme:sky -o d-nokai4.html 2014-11-20-d-nokai4.md
-->

<h2>Range, 文字列, 連想配列</h2>

<hr>

<h3>順番</h3>

<ul>
<li>type, qualifier</li>
<li>array, GC and foreach-loop</li>
<li><strong>string, UTF</strong></li>
<li><strong>Associative Array(HashMap)</strong></li>
<li>function(template)</li>
<li>Exception, scope(exit|failure|success), DbC, unittest</li>
<li>revisit function</li>
<li>revisit template-function</li>
<li>struct, union</li>
<li>class, interface,</li>
<li>re-revisit template</li>
</ul>

<hr>

<h3>復習-1</h3>

<p>Project Euler problem-1より。</p>

<blockquote>
<p>10未満の自然数のうち, 3 もしくは 5 の倍数になっているものは 3, 5, 6, 9 の4つがあり, これらの合計は 23 になる.<br>
同じようにして, 1000 未満の 3 か 5 の倍数になっている数字の合計を求めよ.  </p>
</blockquote>

<p>正解：233168</p>

<hr>

<h3>復習−1−2</h3>

<p>以下の関数を使って解いてみる</p>

<ul>
<li><code>iota(1, 1000)</code></li>
<li><code>filter!&quot;....&quot;</code></li>
<li><code>reduce!&quot;....&quot;</code></li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">filter</span><span class="p">!</span><span class="s">&quot;(a &amp; 0x3) == 0&quot;</span>    <span class="p">-&gt;</span> <span class="p">[</span><span class="mi">4</span><span class="p">]</span>

<span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">].</span><span class="n">reduce</span><span class="p">!</span><span class="s">&quot;a * b&quot;</span>             <span class="p">-&gt;</span> <span class="mi">24</span>
</code></pre></div>
<hr>

<h3>復習−2</h3>

<p>Project Euler problem-2より。</p>

<blockquote>
<p>フィボナッチ数列の項は前の2つの項の和である. 最初の2項を 1, 2 とすれば, 最初の10項は以下の通りである.<br>
1, 2, 3, 5, 8, 13, 21, 34, 55, 89, ...<br>
数列の項の値が400万以下の, 偶数値の項の総和を求めよ.  </p>
</blockquote>

<p>正解：4613732</p>

<hr>

<h3>復習−2−1</h3>

<p>以下の関数を使って解いてみる</p>

<ul>
<li><code>recurrence!&quot;....&quot;</code></li>
<li><code>until!&quot;....&quot;</code></li>
<li><code>filter!&quot;....&quot;</code></li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="n">recurrence</span><span class="p">!</span><span class="s">&quot;a[n-1] * (n+1)&quot;</span><span class="p">(</span><span class="mi">1</span><span class="p">).</span><span class="n">until</span><span class="p">!</span><span class="s">&quot;a &gt; b&quot;</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>    <span class="p">-&gt;</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">720</span><span class="p">]</span>
</code></pre></div>
<hr>

<h2>Range</h2>

<ul>
<li>リストの抽象的表現</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">auto</span> <span class="n">popHead</span><span class="p">(</span><span class="n">R</span><span class="p">)(</span><span class="k">ref</span> <span class="n">R</span> <span class="n">r</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">enforce</span><span class="p">(!</span><span class="n">r</span><span class="p">.</span><span class="n">empty</span><span class="p">);</span>  <span class="c1">// 空か？</span>

    <span class="k">auto</span> <span class="n">e</span> <span class="p">=</span> <span class="n">r</span><span class="p">.</span><span class="n">front</span><span class="p">;</span>   <span class="c1">// 先頭要素</span>
    <span class="n">r</span><span class="p">.</span><span class="n">popFront</span><span class="p">();</span>       <span class="c1">// 先頭を消す</span>
    <span class="k">return</span> <span class="n">e</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>配列とRange</h3>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">array</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">arr</span> <span class="p">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">];</span>

    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">empty</span><span class="p">);</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">front</span><span class="p">);</span>
    <span class="n">arr</span><span class="p">.</span><span class="n">popFront</span><span class="p">();</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">);</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">empty</span><span class="p">);</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">front</span><span class="p">);</span>
    <span class="n">arr</span> <span class="p">=</span> <span class="p">[];</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">arr</span><span class="p">.</span><span class="n">empty</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>Rangeを作ってみる</h3>

<ul>
<li>0, 1, 2, 3, ...</li>
<li>無限レンジ</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="n">range</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">InfSeq</span><span class="p">{</span>
    <span class="k">enum</span> <span class="kt">bool</span> <span class="n">empty</span> <span class="p">=</span> <span class="kc">false</span><span class="p">;</span>    <span class="c1">// 終わりなし</span>
    <span class="kt">int</span> <span class="n">front</span><span class="p">()</span> <span class="nd">@property</span> <span class="p">{</span> <span class="k">return</span> <span class="n">_i</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">void</span> <span class="n">popFront</span><span class="p">()</span> <span class="p">{</span> <span class="p">++</span><span class="n">_i</span><span class="p">;</span> <span class="p">}</span>
    <span class="k">private</span> <span class="kt">int</span> <span class="n">_i</span><span class="p">;</span>
<span class="p">}</span>


<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">InfSeq</span><span class="p">().</span><span class="n">take</span><span class="p">(</span><span class="mi">100</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>準備</h2>

<p>WindowsでUTF文字列を表示させる</p>

<ul>
<li>ターミナルの対応</li>
<li>関数のハイジャック</li>
</ul>

<hr>

<h3>ターミナルの対応</h3>

<ul>
<li><code>chcp 65001</code></li>
<li>フォントを変える</li>
</ul>

<hr>

<h3>関数ハイジャック</h3>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">algorithm</span><span class="p">;</span>
<span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">conv</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="n">format</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="nb">string</span><span class="p">;</span>
<span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">windows</span><span class="p">.</span><span class="n">charset</span><span class="p">;</span>
<span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="k">version</span><span class="p">(</span><span class="n">Windows</span><span class="p">)</span>
<span class="p">{</span>
  <span class="k">template</span> <span class="n">writeImpl</span><span class="p">(</span><span class="k">alias</span> <span class="n">f</span><span class="p">,</span> <span class="nb">string</span> <span class="n">ln</span><span class="p">)</span>
  <span class="p">{</span> <span class="kt">void</span> <span class="n">writeImpl</span><span class="p">(</span><span class="n">T</span><span class="p">...)(</span><span class="k">auto</span> <span class="k">ref</span> <span class="n">T</span> <span class="n">args</span><span class="p">)</span>
    <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="n">f</span><span class="p">(</span><span class="n">forward</span><span class="p">!</span><span class="n">args</span><span class="p">).</span><span class="n">toMBSz</span><span class="p">);</span>
      <span class="n">printf</span><span class="p">(</span><span class="n">ln</span><span class="p">);</span> <span class="p">}}</span>

  <span class="k">alias</span> <span class="n">write</span> <span class="p">=</span> <span class="n">writeImpl</span><span class="p">!(</span><span class="n">text</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="k">alias</span> <span class="n">writef</span> <span class="p">=</span> <span class="n">writeImpl</span><span class="p">!(</span><span class="n">format</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">);</span>
  <span class="k">alias</span> <span class="n">writeln</span> <span class="p">=</span> <span class="n">writeImpl</span><span class="p">!(</span><span class="n">text</span><span class="p">,</span> <span class="s">&quot;\r\n&quot;</span><span class="p">);</span>
  <span class="k">alias</span> <span class="n">writefln</span> <span class="p">=</span> <span class="n">writeImpl</span><span class="p">!(</span><span class="n">format</span><span class="p">,</span> <span class="s">&quot;\r\n&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="n">writeln</span><span class="p">(</span><span class="s">&quot;ああああ&quot;</span><span class="p">);</span>
    <span class="n">writef</span><span class="p">(</span><span class="s">&quot;嗚呼唖々&quot;</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>UTF-32</h2>

<ul>
<li>一文字 == 4byte固定</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// dchar, dstring が UTF-32</span>
    <span class="nb">dstring</span><span class="p">[]</span> <span class="n">ss</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;あ&quot;</span><span class="p">,</span> <span class="s">&quot;阿&quot;</span><span class="p">,</span> <span class="s">&quot;\U0001F363&quot;</span><span class="p">];</span>

     <span class="k">foreach</span><span class="p">(</span><span class="n">s</span><span class="p">;</span> <span class="n">ss</span><span class="p">)</span>
        <span class="n">writefln</span><span class="p">(</span><span class="s">`%(%s%) =&gt; %(%02X%)`</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">immutable</span><span class="p">(</span><span class="kt">ubyte</span><span class="p">)[])</span><span class="n">s</span><span class="p">).</span><span class="n">dup</span><span class="p">.</span><span class="n">reverse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

UTF-16</h2>

<ul>
<li>基本：1文字 == 2byte</li>
<li>サロゲートペア(2byte*2で一文字)</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// wchar, wstring が UTF-32</span>
    <span class="nb">wstring</span><span class="p">[]</span> <span class="n">ss</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;あ&quot;</span><span class="p">,</span> <span class="s">&quot;阿&quot;</span><span class="p">,</span> <span class="s">&quot;\U0001F363&quot;</span><span class="p">];</span>

     <span class="k">foreach</span><span class="p">(</span><span class="n">s</span><span class="p">;</span> <span class="n">ss</span><span class="p">)</span>
        <span class="n">writefln</span><span class="p">(</span><span class="s">`%(%s%) =&gt; %(%02X%)`</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">immutable</span><span class="p">(</span><span class="kt">ubyte</span><span class="p">)[])</span><span class="n">s</span><span class="p">).</span><span class="n">dup</span><span class="p">.</span><span class="n">reverse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>UTF-8</h2>

<ul>
<li>1～6 byteまでの可変長</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// char, string が UTF-32</span>
    <span class="nb">string</span><span class="p">[]</span> <span class="n">ss</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;a&quot;</span><span class="p">,</span> <span class="s">&quot;あ&quot;</span><span class="p">,</span> <span class="s">&quot;阿&quot;</span><span class="p">,</span> <span class="s">&quot;\U0001F363&quot;</span><span class="p">];</span>

     <span class="k">foreach</span><span class="p">(</span><span class="n">s</span><span class="p">;</span> <span class="n">ss</span><span class="p">)</span>
        <span class="n">writefln</span><span class="p">(</span><span class="s">`%(%s%) =&gt; %(%02X%)`</span><span class="p">,</span> <span class="p">[</span><span class="n">s</span><span class="p">],</span> <span class="p">(</span><span class="k">cast</span><span class="p">(</span><span class="k">immutable</span><span class="p">(</span><span class="kt">ubyte</span><span class="p">)[])</span><span class="n">s</span><span class="p">).</span><span class="n">dup</span><span class="p">.</span><span class="n">reverse</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>問題</h2>

<ul>
<li>文字列の先頭文字を得るには？</li>
<li>ヒント

<ul>
<li>immutable(char|wchar|dchar)[]</li>
</ul></li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">auto</span> <span class="n">getHead</span><span class="p">(</span><span class="n">S</span><span class="p">)(</span><span class="n">S</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>UTF-32の場合</h3>

<ul>
<li>1文字は4byte固定</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nb">dstring</span> <span class="n">str</span> <span class="p">=</span> <span class="s">&quot;トヨッキー&quot;</span><span class="p">;</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>UTF-8の場合</h3>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nb">string</span> <span class="n">str</span> <span class="p">=</span> <span class="s">&quot;トヨッキー&quot;</span><span class="p">;</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">str</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>    <span class="c1">// 文字化け</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>UTF-8：可変長</h3>

<ul>
<li><code>str[0]</code>は先頭の1byteだけ</li>
<li>UTF-32に変換してしまう</li>
<li>Range</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">array</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="n">utf</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="nb">string</span> <span class="n">str</span> <span class="p">=</span> <span class="s">&quot;トヨッキー&quot;</span><span class="p">;</span>

    <span class="c1">// UTF-32に変換して、先頭文字だけ返す</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">toUTF32</span><span class="p">()[</span><span class="mi">0</span><span class="p">]);</span>  <span class="c1">// dchar</span>

    <span class="c1">// 先頭文字をUTF-32にして返す</span>
    <span class="n">writeln</span><span class="p">(</span><span class="n">str</span><span class="p">.</span><span class="n">front</span><span class="p">);</span>         <span class="c1">// dchar</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>UTF-16の場合</h3>

<ul>
<li>基本的には1文字は2byte</li>
<li><p>サロゲートペア：4byteで1文字</p>

<ul>
<li>めったにないけど。</li>
</ul></li>
<li><p>UTF-8と同じように処理</p></li>
</ul>

<hr>

<h3>文字列のまとめ</h3>

<ul>
<li>UTF-32に一度変換してしまうのが楽</li>
<li>文字列のRangeは、UTF-32のシーケンス</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="c1">// 推論させると、immutable(char)になる</span>
    <span class="c1">// dcharにしたいなら、明示的に書く必要がある</span>
    <span class="k">foreach</span><span class="p">(</span><span class="kt">dchar</span> <span class="n">e</span><span class="p">;</span> <span class="s">&quot;あああ&quot;</span><span class="p">)</span>
        <span class="n">writeln</span><span class="p">(</span><span class="n">e</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>文字列の問題</h3>

<ul>
<li><a href="https://k3kaimu.github.io/dmanual/string/">d-manual</a></li>
</ul>

<hr>

<h3>入力</h3>

<p>標準入力から一行取得する。</p>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="n">range</span><span class="p">,</span>
       <span class="n">std</span><span class="p">.</span><span class="n">conv</span><span class="p">,</span> <span class="n">std</span><span class="p">.</span><span class="nb">string</span><span class="p">;</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">immutable</span> <span class="n">n</span> <span class="p">=</span> <span class="n">readln</span><span class="p">()</span>  <span class="c1">// 1行</span>
                 <span class="p">.</span><span class="n">chomp</span><span class="p">()</span>   <span class="c1">// 末尾\r\n削除</span>
                 <span class="p">.</span><span class="n">to</span><span class="p">!</span><span class="kt">uint</span><span class="p">;</span>  <span class="c1">// 変換</span>

    <span class="c1">// 入力の各行に対してループ</span>
    <span class="k">foreach</span><span class="p">(</span><span class="n">line</span><span class="p">;</span> <span class="n">stdin</span><span class="p">.</span><span class="n">byLine</span><span class="p">)</span>
        <span class="n">writeln</span><span class="p">(</span><span class="n">line</span><span class="p">.</span><span class="n">take</span><span class="p">(</span><span class="n">n</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h2>連想配列</h2>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="p">[</span><span class="nb">string</span><span class="p">]</span> <span class="n">aa</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;1&quot;</span> <span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;2&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">];</span>

    <span class="n">aa</span><span class="p">[</span><span class="s">&quot;4&quot;</span><span class="p">]</span> <span class="p">=</span> <span class="mi">5</span><span class="p">;</span>
    <span class="k">if</span><span class="p">(</span><span class="k">auto</span> <span class="n">p</span> <span class="p">=</span> <span class="s">&quot;3&quot;</span> <span class="k">in</span> <span class="n">aa</span><span class="p">)</span>
        <span class="n">writeln</span><span class="p">(*</span><span class="n">p</span><span class="p">);</span>    <span class="c1">// aa[&quot;3&quot;]</span>
    <span class="k">else</span>
        <span class="n">writeln</span><span class="p">(</span><span class="s">&quot;aa does not have 3&quot;</span><span class="p">);</span>

    <span class="n">writeln</span><span class="p">(</span><span class="n">aa</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>

    <span class="n">aa</span><span class="p">.</span><span class="n">remove</span><span class="p">(</span><span class="s">&quot;4&quot;</span><span class="p">);</span>
    <span class="k">assert</span><span class="p">(</span><span class="s">&quot;4&quot;</span> <span class="p">!</span><span class="k">in</span> <span class="n">aa</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>foreach</h3>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="k">auto</span> <span class="n">madoMagi</span> <span class="p">=</span> <span class="p">[</span><span class="s">&quot;mado&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&quot;homu&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span>
                     <span class="s">&quot;saya&quot;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s">&quot;anko&quot;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s">&quot;mami&quot;</span><span class="p">:</span> <span class="mi">5</span><span class="p">];</span>

    <span class="k">foreach</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">;</span> <span class="n">madoMagi</span><span class="p">)</span>
        <span class="n">writefln</span><span class="p">(</span><span class="s">&quot;%s : %s&quot;</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>

    <span class="n">writeln</span><span class="p">();</span>

    <span class="k">foreach</span><span class="p">(</span><span class="n">k</span><span class="p">,</span> <span class="k">ref</span> <span class="n">v</span><span class="p">;</span> <span class="n">madoMagi</span><span class="p">)</span>
        <span class="n">v</span> <span class="p">=</span> <span class="mi">100</span><span class="p">;</span>

    <span class="n">writefln</span><span class="p">(</span><span class="s">&quot;%-(%s : %s%|\n%)&quot;</span><span class="p">,</span> <span class="n">madoMagi</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>その他の列挙方法</h3>

<ul>
<li><code>aa.byKey</code>：キーのレンジ</li>
<li><code>aa.keys</code>：キーの配列(新たに確保)</li>
<li><code>aa.byValue</code>：値のレンジ</li>
<li><code>aa.values</code>：値の配列(新たに確保)</li>
</ul>

<hr>

<h3>ユーザー定義のキー型</h3>

<ul>
<li>デフォルトではバイナリから算出</li>
<li>ユーザーがカスタマイズ可能</li>
</ul>
<div class="highlight"><pre><code class="language-d" data-lang="d"><span class="c1">/// test.d</span>
<span class="k">import</span> <span class="n">std</span><span class="p">.</span><span class="n">stdio</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">MyKey</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">a</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">b</span><span class="p">;</span>  <span class="c1">// これを無視したい</span>

    <span class="n">hash_t</span> <span class="n">toHash</span><span class="p">()</span> <span class="k">const</span> <span class="k">nothrow</span> <span class="nd">@safe</span> <span class="p">{</span> <span class="k">return</span> <span class="n">a</span><span class="p">;</span> <span class="p">}</span>
    <span class="kt">bool</span> <span class="n">opEquals</span><span class="p">(</span><span class="k">ref</span> <span class="k">const</span> <span class="n">MyKey</span> <span class="n">rhs</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span> <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">a</span> <span class="p">==</span> <span class="n">rhs</span><span class="p">.</span><span class="n">a</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">main</span><span class="p">()</span>
<span class="p">{</span>
    <span class="kt">int</span><span class="p">[</span><span class="n">MyKey</span><span class="p">]</span> <span class="n">aa</span><span class="p">;</span>

    <span class="n">aa</span><span class="p">[</span><span class="n">MyKey</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span> <span class="p">=</span> <span class="mi">12</span><span class="p">;</span>
    <span class="n">aa</span><span class="p">[</span><span class="n">MyKey</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)]</span> <span class="p">=</span> <span class="mi">3</span><span class="p">;</span>
    <span class="n">aa</span><span class="p">[</span><span class="n">MyKey</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="p">=</span> <span class="mi">4</span><span class="p">;</span>

    <span class="n">aa</span><span class="p">[</span><span class="n">MyKey</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">)]</span> <span class="p">=</span> <span class="mi">8</span><span class="p">;</span>   <span class="c1">// rewrite</span>

    <span class="n">writeln</span><span class="p">(</span><span class="n">aa</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>
<hr>

<h3>問題</h3>

<ul>
<li><a href="https://k3kaimu.github.io/dmanual/associative_array/">d-manual</a></li>
</ul>

              </div>
            </div>
          </div>
          <div class="row">
  <div class="col-md-12 col-sm-12 col-xs-12">
    <div class="page-footer">
      <div class="list-group">
        <a href="/archives/#y-2014" class="list-group-item col-md-3 col-sm-4 col-xs-6">
          <i class="fa fa fa-archive fa-lg"></i> 
          <em itemprop="datePublished" content="2014-11-20">
            20 Nov 2014
          </em>
        </a>
        
        <a href="/categories/#dの会" class="list-group-item col-md-3 col-sm-4 col-xs-6">
          <i class="fa fa-folder-open fa-lg"></i> <em itemprop="keywords">Dの会</em>
          <span class="badge">2</span>
        </a>
        
        
        <a href="/tags/#dmanual" class="list-group-item col-md-3 col-sm-4 col-xs-6">
          <i class="fa fa-tag fa-lg"></i> <em itemprop="keywords">dmanual</em>
          <span class="badge">4</span>
        </a>
        
        <a href="/tags/#blog" class="list-group-item col-md-3 col-sm-4 col-xs-6">
          <i class="fa fa-tag fa-lg"></i> <em itemprop="keywords">blog</em>
          <span class="badge">7</span>
        </a>
        
        <a href="/tags/#dの会" class="list-group-item col-md-3 col-sm-4 col-xs-6">
          <i class="fa fa-tag fa-lg"></i> <em itemprop="keywords">Dの会</em>
          <span class="badge">2</span>
        </a>
        
    </div>
    <div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'dmanual'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
  </div>
</div>
        </article>
      </div>
    </div>
    
<div class="footer">
  <div class="container">
    <hr/>
    <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">
        <ul class="nav nav-pills">
          
          <li>
            <a href="https://www.github.com/k3kaimu">
              <i class="fa fa-github-square fa-lg"></i> GitHub
            </a>
          </li>
          
          
          <li>
            <a href="http://www.twitter.com/k3_kaimu">
              <i class="fa fa-twitter-square fa-lg"></i> Twitter
            </a>
          </li>
          
          
          
          <li>
            <a href="/atom.xml">
              <i class="fa fa-rss-square fa-lg"></i> Rss
            </a>
          </li>
          <li class="pull-right visible-md visible-lg">
            <a href="#top">
              <i class="fa fa-arrow-circle-up fa-lg"></i> Back to top
            </a>
          </li>
        </ul>
      </div>
    </div>
    <div class="row">
      <div class="col-md-12 col-sm-12 col-xs-12">        
        <p>
          &copy; k3-kaimu 2015 
          with help from <a href="https://github.com/ogaclejapan/jekyllstrap" target="_blank" title="jekyllstrap is Jekyll template based on Bootstrap.">Jekyllstrap</a>.
        </p>
        <p>
          Based on <a href="http://jekyllrb.com/" target="_blank">Jekyll</a>. 
          Themes from <a href="http://getbootstrap.com/" target="_blank">Bootstrap</a> and <a href="http://bootswatch.com/" target="_blank">Bootswatch</a>. 
          Icons from <a href="http://fontawesome.io/" target="_blank">Font Awesome</a>.
        </p>
        <p>
        <a href="https://github.com/k3kaimu/k3kaimu.github.io/commits/src/_posts/2014-11-20-d-nokai4.md">View this page's history on GitHub</a>
        </p>
      </div>
    </div>
    <div class="row">
    <form action="http://www.google.com/cse" id="cse-search-box">
<input type="hidden" name="cx" value="004390249242222246033:d_53xmyptd0" />
<input type="hidden" name="ie" value="UTF-8" />
<input type="text" name="q" size="31" />
<input type="submit" name="sa" value="&#xf00e;" />
</form>
<script type="text/javascript" src="//www.google.com/cse/brand?form=cse-search-box&lang=ja"></script>

    </div>
  </div>
</div>


    
<div id="back-to-top">
  <a href="#top"><i class="fa fa-arrow-circle-up fa-5x"></i></a>
</div>

    
<script src="//code.jquery.com/jquery-2.0.3.min.js"></script>
<script src="//netdna.bootstrapcdn.com/bootstrap/3.0.3/js/bootstrap.min.js"></script>
<script src="/assets/js/all.min.js"></script>



    


  </body>
</html>
